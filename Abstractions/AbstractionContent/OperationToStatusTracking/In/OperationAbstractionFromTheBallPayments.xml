<?xml version="1.0"?>
<OperationAbstraction xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://tempuri.org/Operation_v1_0.xsd">
  <Operations codeNamespace="TheBall.Payments">
    <Operation name="ActivateAndPayGroupSubscriptionPlan">
      <OperationSpec>
        <Description>Activate and pay group subscription</Description>
      </OperationSpec>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="PaymentToken" dataType="INT.PaymentToken" designDesc="Obtain Stripe Token from request stream" state="implemented" />
          <MethodExecute name="ValidateMatchingEmail" designDesc="Validate that account active email matches payment token email" state="implemented">
            <Target name="PaymentToken" />
          </MethodExecute>
          <TargetDefinition name="AccountID" dataType="string" designDesc="Active account ID" state="implemented" />
          <TargetDefinition name="CustomerAccount" dataType="CustomerAccount" designDesc="Customer account object based accountID. Created if missing" state="implemented">
            <Target name="AccountID" />
          </TargetDefinition>
          <TargetDefinition name="PlanName" dataType="string" designDesc="Plan name from the payment token" state="implemented">
            <Target name="PaymentToken" />
          </TargetDefinition>
          <MethodExecute name="ProcessPayment" designDesc="Process payment to Stripe" state="implemented">
            <Target name="PaymentToken" />
            <Target name="CustomerAccount" />
          </MethodExecute>
          <MethodExecute name="GrantAccessToAccount" designDesc="Grant plan access to account" state="implemented">
            <Target name="PlanName" />
            <Target name="AccountID" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="CancelGroupSubscriptionPlan">
      <OperationSpec>
        <Description>Cancel group paid subscription</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="PlanName" dataType="string" designDesc="Plan Name" state="implemented" />
        <Parameter name="AccountID" dataType="string" designDesc="Account ID to grant access for" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="CustomerAccount" dataType="CustomerAccount" designDesc="Customer account object based on account ID. Must be found" state="implemented">
            <Parameter name="AccountID" />
          </TargetDefinition>
          <MethodExecute name="CancelSubscriptionPlan" designDesc="Cancel subscription plan on Stripe" state="implemented">
            <Parameter name="PlanName" />
            <Target name="CustomerAccount" />
          </MethodExecute>
          <MethodExecute name="RevokeAccessFromAccount" designDesc="Revoke plan access to account" state="implemented">
            <Parameter name="PlanName" />
            <Parameter name="AccountID" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="GrantPlanAccessToAccount">
      <OperationSpec>
        <Description>Grant plan access to account</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="PlanName" dataType="string" designDesc="Plan Name" state="implemented" />
        <Parameter name="AccountID" dataType="string" designDesc="Account ID to grant access for" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="GroupSubscriptionPlan" dataType="GroupSubscriptionPlan" designDesc="Group subscription plan of given name" state="implemented">
            <Parameter name="PlanName" />
          </TargetDefinition>
          <MethodExecute name="GrantAccessToAccountForPlanGroups" designDesc="Grant access to plan groups. Using GrantPaidAccessToGroup operation" state="implemented">
            <Parameter name="AccountID" />
            <Target name="GroupSubscriptionPlan" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="GrantPaidAccessToGroup">
      <OperationSpec>
        <Description>Grant paid access to group</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="GroupID" dataType="string" designDesc="Group ID to grant access to" state="implemented" />
        <Parameter name="AccountID" dataType="string" designDesc="Account ID to grant access for" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <MethodExecute name="AddAccountToGroup" designDesc="Add account to group by inviting and confirming. Grant as visitor role." state="implemented">
            <Parameter name="GroupID" />
            <Parameter name="AccountID" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="RemovePlanAccessFromAccount">
      <OperationSpec>
        <Description>Remove plan access from account</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="PlanName" dataType="string" designDesc="Plan Name" state="implemented" />
        <Parameter name="AccountID" dataType="string" designDesc="Account ID to grant access for" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="GroupSubscriptionPlan" dataType="GroupSubscriptionPlan" designDesc="Group subscription plan of given name" state="implemented">
            <Parameter name="PlanName" />
          </TargetDefinition>
          <MethodExecute name="RemoveAccessFromAccountForPlanGroups" designDesc="Revoke access from plan groups. Using RevokePaidAccessFromGroup operation" state="implemented">
            <Parameter name="AccountID" />
            <Target name="GroupSubscriptionPlan" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="RevokePaidAccessFromGroup">
      <OperationSpec>
        <Description>Revoke paid access to group</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="GroupID" dataType="string" designDesc="Group ID to revoke access from" state="implemented" />
        <Parameter name="AccountID" dataType="string" designDesc="Account ID to revoke access from" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <MethodExecute name="RemoveAccountFromGroup" designDesc="Remove account from group." state="implemented">
            <Parameter name="GroupID" />
            <Parameter name="AccountID" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="ProcessPayment">
      <OperationSpec>
        <Description>Process Stripe payment</Description>
      </OperationSpec>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="PaymentToken" dataType="INT.PaymentToken" designDesc="Obtain Stripe Token from request stream" state="implemented" />
          <MethodExecute name="ValidateMatchingEmail" designDesc="Validate that account active email matches payment token email" state="implemented">
            <Target name="PaymentToken" />
          </MethodExecute>
          <TargetDefinition name="CustomerAccount" dataType="CustomerAccount" designDesc="Customer account object based on active account ID. Created if missing" state="implemented" />
          <MethodExecute name="ProcessPayment" designDesc="Process payment to Stripe" state="implemented">
            <Target name="PaymentToken" />
            <Target name="CustomerAccount" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="FetchCustomersFromStripe">
      <OperationSpec>
        <Description>Fetch customers from Stripe</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="GroupID" dataType="string" designDesc="Group ID to fetch the customers to" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="Owner" dataType="TheBall.CORE.IContainerOwner" designDesc="Validate group ID as valid Payments managing group" state="implemented">
            <Parameter name="GroupID" />
          </TargetDefinition>
          <TargetDefinition name="StripeCustomers" dataType="Stripe.StripeCustomer[]" designDesc="Stripe customers from service call" state="implemented" />
          <TargetDefinition name="CurrentCustomers" dataType="CustomerAccountCollection" designDesc="Current customer collection" state="implemented">
            <Target name="Owner" />
          </TargetDefinition>
          <TargetDefinition name="NewCustomersToCreate" dataType="CustomerAccount[]" designDesc="New customers to create" state="implemented">
            <Target name="Owner" />
            <Target name="StripeCustomers" />
            <Target name="CurrentCustomers" />
          </TargetDefinition>
          <MethodExecute name="StoreObjects" designDesc="Store new customers" state="implemented">
            <Target name="Owner" />
            <Target name="NewCustomersToCreate" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="AssociatePaymentToGroup">
      <OperationSpec>
        <Description>Associate payment to group</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="GroupID" dataType="string" designDesc="ID of the group to associate the payment to" state="implemented" />
        <Parameter name="PaymentID" dataType="string" designDesc="ID of the payment to connect to group" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="GroupAsOwner" dataType="TheBall.CORE.IContainerOwner" designDesc="Group as owner" state="implemented">
            <Parameter name="GroupID" />
          </TargetDefinition>
        </SequentialExecution>
      </Execution>
    </Operation>
  </Operations>
</OperationAbstraction>